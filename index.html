<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: block;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .radio-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
        }
        button {
            width: 100%;
            padding: 10px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        .records-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            margin-bottom: 20px;
        }
        .record {
            background: #e9ecef;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }



.user-list {
    list-style: decimal inside;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 5px;
    max-width: 300px;
    margin: 10px auto;
    font-size: 16px;
}

.user-item {
    padding: 5px;
    border-bottom: 1px solid #ddd;
}

.user-item:last-child {
    border-bottom: none;
}
        .register-button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #28a745;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
    transition: background 0.3s ease-in-out, transform 0.1s;
            display: flex;
    justify-content: center;
}

/* Hover effect */
.register-button:hover {
    background-color: #218838;
}

/* Click effect */
.register-button:active {
    transform: scale(0.98);
}



.delete-all-button {
    width: 50%;
    padding: 10px;
    border: none;
    background-color: #dc3545;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease-in-out, transform 0.1s;
    margin-top: 15px;
}

.delete-all-button:hover {
    background-color: #c82333;
}

.delete-all-button:active {
    transform: scale(0.98);
}

#delete-response-message {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
}


.update-password-container {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 5px;
    max-width: 300px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.update-password-field {
    margin-bottom: 15px;
}

.update-password-field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.update-password-field input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

.update-password-button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #007bff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease-in-out, transform 0.1s;
    margin-top: 10px;
}

.update-password-button:hover {
    background-color: #0056b3;
}

.update-password-button:active {
    transform: scale(0.98);
}

#update-password-response {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
}



.user-count-container {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 5px;
    max-width: 300px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
}

#total-user-count {
    font-size: 20px;
    color: #007bff;
}
.delete-user-container {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 5px;
    max-width: 300px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.delete-user-field {
    margin-bottom: 15px;
}

.delete-user-field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.delete-user-field input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

.delete-user-button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #d9534f;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease-in-out, transform 0.1s;
    margin-top: 10px;
}

.delete-user-button:hover {
    background-color: #c9302c;
}

.delete-user-button:active {
    transform: scale(0.98);
}

#delete-user-response {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
}


.search-user-container {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 5px;
    max-width: 300px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.search-user-field {
    margin-bottom: 15px;
}

.search-user-field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.search-user-field input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

.search-user-button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #007bff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease-in-out, transform 0.1s;
    margin-top: 10px;
}

.search-user-button:hover {
    background-color: #0056b3;
}

.search-user-button:active {
    transform: scale(0.98);
}

#user-info {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
}

.search-records-container {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    border-radius: 5px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.search-records-field {
    margin-bottom: 15px;
}

.search-records-field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.search-records-field input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

.search-records-button {
    width: 100%;
    padding: 10px;
    border: none;
    background-color: #007bff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease-in-out, transform 0.1s;
    margin-top: 10px;
}

.search-records-button:hover {
    background-color: #0056b3;
}

.search-records-button:active {
    transform: scale(0.98);
}

#records-info {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
}

.records-list {
    list-style: none;
    padding: 0;
}

.record-item {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    background: white;
    margin-bottom: 5px;
    border-radius: 4px;
    text-align: left;
}












        
        
    </style>
</head>
<body>
    <div class="container">
        <form id="contact-form">
            <div class="form-group">
                <label for="ime">Name:</label>
                <input type="text" id="ime" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>






            
            <div class="form-group">
                <label for="phone">Phone:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <div class="form-group">
                <label for="country">Country:</label>
                <input type="text" id="country" name="country" required>
            </div>

            <div class="form-group">
                <label for="city">City:</label>
                <input type="text" id="city" name="city" required>
            </div>
             <div class="form-group">
                <label for="card">Card:</label>
                <input type="text" id="card" name="card" required>
            </div>

            <div class="form-group">
                <label for="state">State:</label>
                <input type="text" id="state" name="state" required>
            </div>
            
            <div class="form-group">
                <label for="zipcode">Zip Code:</label>
                <input type="text" id="zipcode" name="zipcode" required>
            </div>

            <div class="form-group">
                <label>Gender:</label>
                <div class="radio-group">
                    <label><input type="radio" name="gender" value="male" required> Male</label>
                    <label><input type="radio" name="gender" value="female" required> Female</label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" required>
            </div>
           
            <div class="form-group">
                <label for="poruka">Message:</label>
                <textarea id="poruka" name="message" rows="4" required></textarea>
            </div>
            <button type="submit">Send</button>
        </form>
    </div>
    
    <div class="records-container">
        <h3>First 10 Records</h3>
        <div id="first-records-list"></div>
    </div>
    
    <div class="records-container">
        <h3>Latest 20 Records</h3>
        <div id="latest-records-list"></div>
    </div>
    <div class="records-container">
        <h3>Distinct Countries</h3>
        <div id="distinct-records-list"></div>
    </div>



      <div class="records-container">
        <h3>First 40 Records</h3>
        <div id="first-40-records-list"></div>
    </div>

   
<div class="records-container">
 <h1>Total number of records in the database: <span id="totalNumber"></span></h1>
    <div id="records-container"></div>
</div>

 <div class="records-container">
        <h3>DB version</h3>
        <div id="get-mongodb-version"></div>
    </div>


 <div class="register-container">
        <form id="register-form">
            <div class="register-field">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
            </div>

            <div class="register-field">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>

            <button type="submit" class="register-button">Send</button>
        </form>

        <p id="response-message"></p>
    </div>
  
     <div class="register-container">
        <h3>Users</h3>
        <div id="get-all-users"></div>
    </div>


<div class="delete-user-container">
    <h3>Delete User</h3>
    <form id="delete-user-form">
        <div class="delete-input-group">
            <label for="delete-username">Username:</label>
            <input type="text" id="delete-username" name="delete-username" required>
        </div>
        <button type="submit" class="delete-button">Delete</button>
    </form>
    <p id="delete-response-message"></p>
</div>

 <button id="delete-all-users" class="delete-all-button">Delete All Users</button>
    <p id="delete-response-message"></p>
</div>


    <div class="delete-records-container">
    <h3>Delete All Records</h3>
    <button id="delete-all-records" class="delete-records-button">Delete All Records</button>
    <p id="delete-records-response"></p>
</div>





<div class="delete-record-container">
    <h3>Delete Record by Position</h3>
    <form id="delete-record-form">
        <div class="delete-record-field">
            <label for="record-position">Enter Record Position:</label>
            <input type="number" id="record-position" name="record-position" min="1" required>
        </div>
        <button type="submit" class="delete-record-button">Delete Record</button>
    </form>
    <p id="delete-record-response"></p>
</div>
    


<div class="update-password-container">
    <h3>Update Password</h3>
    <form id="update-password-form">
        <div class="update-password-field">
            <label for="update-username">Username:</label>
            <input type="text" id="update-username" name="update-username" required>
        </div>

        <div class="update-password-field">
            <label for="new-password">New Password:</label>
            <input type="password" id="new-password" name="new-password" required>
        </div>

        <button type="submit" class="update-password-button">Update Password</button>
    </form>
    <p id="update-password-response"></p>
</div>

<div class="user-count-container">
    <h3>Total Number of Users</h3>
    <p id="total-user-count">Loading...</p>
</div>

<div class="delete-user-container">
    <h3>Delete User by Position</h3>
    <form id="delete-user-form2">
        <div class="delete-user-field">
            <label for="user-position">Enter User Position:</label>
            <input type="number" id="user-position" name="user-position" min="1" required>
        </div>
        <button type="submit" class="delete-user-button">Delete User</button>
    </form>
    <p id="delete-user-response"></p>
</div>



<div class="search-user-container">
    <h3>Search User by Username</h3>
    <form id="search-user-form">
        <div class="search-user-field">
            <label for="search-username">Enter Username:</label>
            <input type="text" id="search-username" name="search-username" required>
        </div>
        <button type="submit" class="search-user-button">Search</button>
    </form>
    <div id="user-info"></div>
</div>

<div class="search-records-container">
    <h3>Search Records by Email</h3>
    <form id="search-records-form">
        <div class="search-records-field">
            <label for="search-email">Enter Email:</label>
            <input type="email" id="search-email" name="search-email" required>
        </div>
        <button type="submit" class="search-records-button">Search</button>
    </form>
    <div id="records-info"></div>
</div>











    

    
    
    <script>
        document.getElementById("contact-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch("https://milancen.duckdns.org/post-data", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert("Message sent successfully!");
                    event.target.reset();
                    fetchRecords();
                    fetchDistinctCountries();
                } else {
                    alert("Failed to send message. Please try again.");
                }
            } catch (error) {
                alert("Error: " + error.message);
            }
        });

        async function fetchRecords() {
    try {
        const [latestResponse, firstResponse, first40Response] = await Promise.all([
            fetch("https://milancen.duckdns.org/get-latest-records"),
            fetch("https://milancen.duckdns.org/get-first-records"),
            fetch("https://milancen.duckdns.org/get-40-records")
        ]);

        const latestRecords = await latestResponse.json();
        const firstRecords = await firstResponse.json();
        const first40Records = await first40Response.json();

        const displayRecords = (records, elementId, count) => {
            const list = document.getElementById(elementId);
            list.innerHTML = "";
            records.slice(0, count).forEach((record, index) => {
                const div = document.createElement("div");
                div.classList.add("record");
                div.innerHTML = `
                    <strong>${index + 1}. ${record.name || 'undefined'}</strong> 
                    (${record.email || 'undefined'}, ${record.phone || 'undefined'}, 
                    ${record.country || 'undefined'}, ${record.city || 'undefined'}, 
                    ${record.state || 'undefined'}, ${record.zipcode || 'undefined'})<br>
                    ${record.gender || 'undefined'} | ${record.date || 'undefined'}<br>
                    ${record.message || 'undefined'} , ${record.card || 'undefined'}
                `;
                list.appendChild(div);
            });
        };

        displayRecords(firstRecords, "first-records-list", 10);
        displayRecords(latestRecords, "latest-records-list", 20);
        displayRecords(first40Records, "first-40-records-list", 40);
            } catch (error) {
                console.error("Error fetching records: ", error);
            }
        }














        

        async function fetchDistinctCountries() {
            try {
                const response = await fetch("https://milancen.duckdns.org/get-distinct-countries");
                const data = await response.json();

                const recordsList = document.getElementById("distinct-records-list");
                recordsList.innerHTML = "";

                data.countries.forEach(country => {
                    const countryDiv = document.createElement("div");
                    countryDiv.classList.add("record");
                    countryDiv.textContent = country;
                    recordsList.appendChild(countryDiv);
                });
            } catch (error) {
                console.error("Error fetching countries:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchRecords();
            fetchDistinctCountries();
        });

        async function fetchRecordCount() {
    try {
        const response = await fetch('https://milancen.duckdns.org/get-record-count');
        const data = await response.json();
        document.getElementById('totalNumber').textContent = data.totalRecords;
    } catch (error) {
        console.error('Error fetching record count:', error);
    }
}

        async function fetchAndDisplayMongoDBVersion() {
    try {
        const response = await fetch('https://milancen.duckdns.org/get-mongodb-version');
        const data = await response.json();
        document.getElementById('get-mongodb-version').textContent = data.mongoVersion;
    } catch (error) {
        console.error('Error fetching MongoDB version:', error);
    }
}

document.addEventListener('DOMContentLoaded', async () => {
    await fetchAndDisplayMongoDBVersion();
});




 async function registerUser(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const responseMessage = document.getElementById('response-message');

            try {
                const response = await fetch('https://milancen.duckdns.org/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const result = await response.json();
                responseMessage.textContent = result.message || 'Registration successful!';
                responseMessage.style.color = 'green';
            } catch (error) {
                console.error('Error during registration:', error);
                responseMessage.textContent = 'Registration failed. Check console for details.';
                responseMessage.style.color = 'red';
            }
        }

        document.getElementById('register-form').addEventListener('submit', registerUser);


 async function fetchAndDisplayUsers() {
    try {
        const response = await fetch('https://milancen.duckdns.org/get-all-users');
        const data = await response.json();

        if (!Array.isArray(data.users) || data.users.length === 0) {
            document.getElementById('get-all-users').textContent = 'No users found.';
            return;
        }

        const usersContainer = document.getElementById('get-all-users');
        usersContainer.innerHTML = ''; // Clear previous content

        const userList = document.createElement('ol'); // Ordered list for numbering
        userList.classList.add('user-list'); // Adding a class for styling

        data.users.forEach(user => {
            const userItem = document.createElement('li');
            userItem.innerHTML = `
                <strong>Username:</strong> ${user.username} <br>
                <strong>Password (Encrypted):</strong> ${btoa(user.password)} <!-- Encrypting password -->
            `;
            userItem.classList.add('user-item'); // Optional for styling
            userList.appendChild(userItem);
        });

        usersContainer.appendChild(userList);
    } catch (error) {
        console.error('Error fetching users:', error);
        document.getElementById('get-all-users').textContent = 'Failed to load users.';
    }
}

document.addEventListener('DOMContentLoaded', fetchAndDisplayUsers);




async function deleteUser(event) {
    event.preventDefault();

    const username = document.getElementById('delete-username').value;
    const responseMessage = document.getElementById('delete-response-message');

    try {
        const response = await fetch('https://milancen.duckdns.org/delete-user', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ username })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        responseMessage.textContent = result.message || `User "${username}" deleted successfully!`;
        responseMessage.style.color = 'green';
    } catch (error) {
        console.error("❌ Error deleting user:", error);
        responseMessage.textContent = 'Failed to delete user. Check console for details.';
        responseMessage.style.color = 'red';
    }
}

document.getElementById('delete-user-form').addEventListener('submit', deleteUser);



        async function deleteAllUsers() {
    if (!confirm("Are you sure you want to delete all users? This action cannot be undone!")) {
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/delete-all-users', {
            method: 'DELETE',
            headers: {
                'Accept': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        document.getElementById('delete-response-message').textContent = result.message || 'All users deleted successfully!';
        document.getElementById('delete-response-message').style.color = 'green';

        fetchAndDisplayUsers(); // Refresh user list
    } catch (error) {
        console.error("❌ Error deleting users:", error);
        document.getElementById('delete-response-message').textContent = 'Failed to delete users. Check console for details.';
        document.getElementById('delete-response-message').style.color = 'red';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    fetchAndDisplayUsers();
    document.getElementById('delete-all-users').addEventListener('click', deleteAllUsers);
});







async function deleteAllRecords() {
    if (!confirm("Are you sure you want to delete all records? This action cannot be undone!")) {
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/delete-all-records', {
            method: 'DELETE',
            headers: {
                'Accept': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        document.getElementById('delete-records-response').textContent = result.message || 'All records deleted successfully!';
        document.getElementById('delete-records-response').style.color = 'green';
    } catch (error) {
        console.error("❌ Error deleting records:", error);
        document.getElementById('delete-records-response').textContent = 'Failed to delete records. Check console for details.';
        document.getElementById('delete-records-response').style.color = 'red';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('delete-all-records').addEventListener('click', deleteAllRecords);
});




async function deleteRecordByPosition(event) {
    event.preventDefault();

    const position = document.getElementById('record-position').value;
    const responseMessage = document.getElementById('delete-record-response');

    if (!position || position < 1) {
        responseMessage.textContent = 'Please enter a valid position (1 or higher).';
        responseMessage.style.color = 'red';
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/delete-by-position', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ position: parseInt(deleteid) })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        responseMessage.textContent = result.message || `Record at position ${deleteid} deleted successfully!`;
        responseMessage.style.color = 'green';
    } catch (error) {
        console.error("❌ Error deleting record:", error);
        responseMessage.textContent = 'Failed to delete record. Check console for details.';
        responseMessage.style.color = 'red';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('delete-record-form').addEventListener('submit', deleteRecordByPosition);
});





async function updatePassword(event) {
    event.preventDefault();

    const username = document.getElementById('update-username').value;
    const newPassword = document.getElementById('new-password').value;
    const responseMessage = document.getElementById('update-password-response');

    if (!username || !newPassword) {
        responseMessage.textContent = 'Please enter both username and new password.';
        responseMessage.style.color = 'red';
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/update-password', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ username, newPassword })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        responseMessage.textContent = result.message || 'Password updated successfully!';
        responseMessage.style.color = 'green';
    } catch (error) {
        console.error("❌ Error updating password:", error);
        responseMessage.textContent = 'Failed to update password. Check console for details.';
        responseMessage.style.color = 'red';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('update-password-form').addEventListener('submit', updatePassword);
});

async function fetchUserCount() {
    try {
        const response = await fetch('https://milancen.duckdns.org/get-user-count');
        const data = await response.json();

        document.getElementById('total-user-count').textContent = `Total Users: ${data.totalRec}`;
    } catch (error) {
        console.error("❌ Error fetching user count:", error);
        document.getElementById('total-user-count').textContent = 'Failed to load user count.';
    }
}

document.addEventListener('DOMContentLoaded', fetchUserCount);


async function deleteUserByPosition(event) {
    event.preventDefault();

    const position = document.getElementById('user-position').value;
    const responseMessage = document.getElementById('delete-user-response');

    if (!position || position < 1) {
        responseMessage.textContent = 'Please enter a valid position (1 or higher).';
        responseMessage.style.color = 'red';
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/delete-user-by-position', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ deleteid: parseInt(position) })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("✅ Server response:", result);

        responseMessage.textContent = result.message || `User at position ${deleteid} deleted successfully!`;
        responseMessage.style.color = 'green';
    } catch (error) {
        console.error("❌ Error deleting user:", error);
        responseMessage.textContent = 'Failed to delete user. Check console for details.';
        responseMessage.style.color = 'red';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('delete-user-form2').addEventListener('submit', deleteUserByPosition);
});


async function searchUser(event) {
    event.preventDefault();

    const username = document.getElementById('search-username').value;
    const userInfoContainer = document.getElementById('user-info');

    if (!username) {
        userInfoContainer.innerHTML = '<p style="color:red;">Please enter a username.</p>';
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/get-user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ username })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const userData = await response.json();
        console.log("✅ Server response:", userData);

        if (userData && Object.keys(userData).length > 0) {
            userInfoContainer.innerHTML = `
                <h4>User Information:</h4>
                <p><strong>Username:</strong> ${userData.username}</p>
                <p><strong>Email:</strong> ${userData.email || 'N/A'}</p>
                <p><strong>Created At:</strong> ${userData.createdAt || 'N/A'}</p>
            `;
        } else {
            userInfoContainer.innerHTML = '<p style="color:red;">User not found.</p>';
        }
    } catch (error) {
        console.error("❌ Error fetching user:", error);
        userInfoContainer.innerHTML = '<p style="color:red;">Failed to fetch user. Check console for details.</p>';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('search-user-form').addEventListener('submit', searchUser);
});

async function searchRecordsByEmail(event) {
    event.preventDefault();

    const email = document.getElementById('search-email').value;
    const recordsContainer = document.getElementById('records-info');

    if (!email) {
        recordsContainer.innerHTML = '<p style="color:red;">Please enter an email address.</p>';
        return;
    }

    try {
        const response = await fetch('https://milancen.duckdns.org/get-records-by-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ email })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log("✅ Server response:", data);

        if (data.records && data.records.length > 0) {
            let recordsHTML = '<h4>Matching Records:</h4><ul class="records-list">';
            data.records.forEach(record => {
                recordsHTML += `
                    <li class="record-item">
                        <strong>Name:</strong> ${record.name} <br>
                        <strong>Email:</strong> ${record.email} <br>
                        <strong>Message:</strong> ${record.message} <br>
                        <strong>Gender:</strong> ${record.gender} <br>
                        <strong>Date:</strong> ${record.date} <br>
                        <strong>Phone:</strong> ${record.phone} <br>
                        <strong>Country:</strong> ${record.country} <br>
                        <strong>Zip Code:</strong> ${record.zipcode} <br>
                        <strong>City:</strong> ${record.city} <br>
                        <strong>State:</strong> ${record.state} <br>
                        <strong>Card:</strong> **** **** **** ${record.card.slice(-4)} <!-- Masking card -->
                    </li>
                `;
            });
            recordsHTML += '</ul>';
            recordsContainer.innerHTML = recordsHTML;
        } else {
            recordsContainer.innerHTML = '<p style="color:red;">No records found for this email.</p>';
        }
    } catch (error) {
        console.error("❌ Error fetching records:", error);
        recordsContainer.innerHTML = '<p style="color:red;">Failed to fetch records. Check console for details.</p>';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('search-records-form').addEventListener('submit', searchRecordsByEmail);
});

        


        

        
        
document.addEventListener('DOMContentLoaded', fetchRecordCount);

    </script>
</body>
</html>
